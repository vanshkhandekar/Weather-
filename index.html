<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Neon 3D Weather App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", system-ui, sans-serif;
    }

    :root {
      --bg1: #020617;
      --bg2: #0b1120;
      --accent: #38bdf8;
      --accent2: #6366f1;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      transition: background 0.6s ease;
    }

    /* THEME BY WEATHER */
    body[data-theme="clear"] {
      background: radial-gradient(circle at top, #0ea5e9, #020617);
    }
    body[data-theme="clouds"] {
      background: radial-gradient(circle at top, #1e293b, #020617);
    }
    body[data-theme="rain"] {
      background: radial-gradient(circle at top, #1d4ed8, #020617);
    }
    body[data-theme="storm"] {
      background: radial-gradient(circle at top, #020617, #030712);
    }
    body[data-theme="fog"] {
      background: radial-gradient(circle at top, #4b5563, #020617);
    }

    /* ANIMATED BACKGROUND */
    body::before {
      content: "";
      position: fixed;
      inset: -40%;
      background: conic-gradient(
        from 140deg,
        #0ea5e9,
        #6366f1,
        #0f172a,
        #0ea5e9
      );
      opacity: 0.25;
      mix-blend-mode: screen;
      filter: blur(10px);
      animation: spinBg 28s linear infinite;
      z-index: -3;
    }

    @keyframes spinBg {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    .bubble {
      position: fixed;
      bottom: -70px;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: rgba(226, 232, 240, 0.95);
      box-shadow: 0 0 20px rgba(148, 163, 184, 0.9);
      opacity: 0.7;
      z-index: -2;
      animation: rise 18s linear infinite;
    }
    .bubble:nth-child(1){ left: 12%; animation-delay: 0s; }
    .bubble:nth-child(2){ left: 42%; animation-delay: 5s; width: 18px; height: 18px; }
    .bubble:nth-child(3){ left: 68%; animation-delay: 10s; width: 26px; height: 26px; }
    .bubble:nth-child(4){ left: 86%; animation-delay: 3s; width: 16px; height: 16px; }

    @keyframes rise {
      0%   { transform: translateY(0) scale(0.9); opacity: 0; }
      10%  { opacity: 0.7; }
      100% { transform: translateY(-120vh) scale(1.1); opacity: 0; }
    }

    /* APP LAYOUT */
    .app-shell {
      width: 100%;
      max-width: 1040px;
      padding: 16px;
      display: grid;
      grid-template-columns: minmax(0, 360px) minmax(0, 360px);
      gap: 18px;
      align-items: stretch;
      justify-content: center;
      perspective: 1200px;
    }

    @media (max-width: 800px) {
      .app-shell {
        max-width: 420px;
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .panel {
      position: relative;
      border-radius: 28px;
      padding: 16px 14px 18px;
      background: linear-gradient(
        145deg,
        rgba(15, 23, 42, 0.96),
        rgba(15, 23, 42, 0.84)
      );
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow:
        0 22px 60px rgba(15, 23, 42, 0.98),
        inset 0 0 40px rgba(15, 23, 42, 0.8);
      overflow: hidden;
      transform-style: preserve-3d;
      transition: transform 0.25s ease-out, box-shadow 0.25s ease-out;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.22), transparent 55%);
      opacity: 0.7;
      pointer-events: none;
      z-index: -1;
    }

    /* Base slight 3D angle for desktop, flat for mobile */
    .panel.current {
      transform: translateZ(0);
    }
    .panel.forecast {
      transform: translateZ(0);
    }

    /* Only on devices with mouse (desktop) -> small tilt on hover */
    @media (pointer: fine) {
      .panel.current {
        transform: rotateX(6deg) rotateY(-6deg);
      }
      .panel.forecast {
        transform: rotateX(6deg) rotateY(6deg);
      }
      .panel.current:hover {
        transform: rotateX(4deg) rotateY(-3deg) translateY(-2px);
      }
      .panel.forecast:hover {
        transform: rotateX(4deg) rotateY(3deg) translateY(-2px);
      }
    }

    .panel-header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .app-title {
      font-size: 18px;
      font-weight: 600;
    }
    .app-subtitle {
      font-size: 11px;
      color: #9ca3af;
    }

    .chip-row {
      display: flex;
      gap: 8px;
      margin: 8px 0 12px;
    }
    .chip {
      padding: 5px 10px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #cbd5f5;
    }
    .chip.active {
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      border: none;
      color: #020617;
      box-shadow: 0 8px 18px rgba(56, 189, 248, 0.8);
    }

    .search-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    .search-row input {
      flex: 1;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 13px;
      outline: none;
    }
    .btn {
      padding: 9px 13px;
      border-radius: 999px;
      border: none;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
    }
    .btn-primary {
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      color: #020617;
      box-shadow: 0 6px 18px rgba(56, 189, 248, 0.9);
    }
    .btn-secondary {
      margin-top: 4px;
      width: 100%;
      background: transparent;
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.7);
    }

    /* CURRENT WEATHER HERO */
    .hero {
      margin-top: 10px;
      padding: 14px;
      border-radius: 22px;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.35), rgba(15, 23, 42, 0.96));
      border: 1px solid rgba(148, 163, 184, 0.6);
      display: flex;
      gap: 10px;
    }

    .hero-left {
      flex: 1;
    }

    .temp-main {
      font-size: 40px;
      font-weight: 800;
      line-height: 1;
    }
    .cond-main {
      font-size: 14px;
      text-transform: capitalize;
    }
    .city-main {
      font-size: 12px;
      color: #cbd5f5;
    }
    .mini-grid {
      margin-top: 8px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
      font-size: 11px;
    }

    .hero-scene {
      width: 100px;
      height: 100px;
      position: relative;
    }

    .sun,
    .moon {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      top: 0;
      right: 6px;
      transform-origin: center;
      animation: float 3.8s ease-in-out infinite;
      opacity: 0;
      box-shadow: 0 0 30px rgba(252, 211, 77, 0.9);
    }
    .sun {
      background: radial-gradient(circle at 30% 30%, #fef3c7, #facc15, #ea580c);
    }
    .moon {
      background: radial-gradient(circle at 30% 30%, #f9fafb, #d4d4d8, #6b7280);
      box-shadow: 0 0 26px rgba(148, 163, 184, 0.9);
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(6px); }
    }

    .cloud-main {
      position: absolute;
      width: 80px;
      height: 44px;
      bottom: 10px;
      right: 10px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #f9fafb, #cbd5f5);
      box-shadow:
        18px 6px 0 rgba(226, 232, 240, 0.96),
        -10px 8px 0 rgba(226, 232, 240, 0.9);
      filter: drop-shadow(0 14px 18px rgba(15, 23, 42, 0.95));
      animation: drift 7s ease-in-out infinite;
      opacity: 0;
    }
    .cloud-small {
      position: absolute;
      width: 46px;
      height: 26px;
      bottom: 20px;
      left: 0;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #f9fafb, #e5e7eb);
      box-shadow: 10px 4px 0 rgba(226, 232, 240, 0.96);
      filter: drop-shadow(0 14px 18px rgba(15, 23, 42, 0.95));
      animation: drift 9s ease-in-out infinite;
      opacity: 0;
    }

    @keyframes drift {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(-10px); }
    }

    .rain-lines {
      position: absolute;
      width: 60px;
      height: 45px;
      right: 16px;
      bottom: -2px;
      overflow: hidden;
      opacity: 0;
    }
    .rain-lines::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: linear-gradient(
        to bottom,
        rgba(248, 250, 252, 0.95) 0,
        rgba(248, 250, 252, 0.95) 40%,
        transparent 40%,
        transparent 100%
      );
      background-size: 2px 11px;
      animation: rainFall 0.35s linear infinite;
    }

    @keyframes rainFall {
      from { transform: translateY(-11px); }
      to   { transform: translateY(0); }
    }

    .fog-strip {
      position: absolute;
      left: -14px;
      right: -14px;
      bottom: 12px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(148, 163, 184, 0.85), transparent 70%);
      filter: blur(3px);
      opacity: 0;
    }

    .bolt {
      position: absolute;
      width: 16px;
      height: 40px;
      right: 35px;
      top: 6px;
      background: linear-gradient(to bottom, #fef3c7, #facc15, #f97316);
      clip-path: polygon(40% 0, 100% 0, 60% 50%, 95% 50%, 0 100%, 40% 50%, 5% 50%);
      box-shadow: 0 0 20px rgba(250, 204, 21, 0.95);
      opacity: 0;
    }

    .status-line {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
    }

    .status-line span {
      color: #a5b4fc;
    }

    /* FORECAST PANEL */
    .forecast-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .forecast-title {
      font-size: 16px;
      font-weight: 600;
    }
    .forecast-sub {
      font-size: 11px;
      color: #9ca3af;
    }
    .badge {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #a5b4fc;
    }

    .hourly-strip {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 6px;
      margin-bottom: 8px;
    }
    .hourly-strip::-webkit-scrollbar {
      height: 3px;
    }
    .hourly-strip::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 999px;
    }

    .hour-card {
      min-width: 70px;
      padding: 6px 6px;
      border-radius: 16px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(51, 65, 85, 0.95);
      font-size: 11px;
      text-align: center;
      transform: translateY(10px);
      opacity: 0;
      animation: slideUp 0.45s forwards;
    }

    .hour-time {
      font-size: 11px;
      color: #cbd5f5;
      margin-bottom: 1px;
    }
    .hour-temp {
      font-weight: 600;
    }
    .hour-cond {
      font-size: 10px;
      text-transform: capitalize;
      color: #9ca3af;
    }

    .forecast-list {
      max-height: 250px;
      overflow-y: auto;
      padding-right: 4px;
    }
    .forecast-list::-webkit-scrollbar {
      width: 3px;
    }
    .forecast-list::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 999px;
    }

    .forecast-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 9px 10px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(51, 65, 85, 0.95);
      font-size: 12px;
      margin-bottom: 7px;
      transform: translateY(12px);
      opacity: 0;
      animation: slideUp 0.45s forwards;
    }

    @keyframes slideUp {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .day-label {
      min-width: 90px;
    }
    .day-main {
      font-weight: 500;
    }
    .day-cond {
      font-size: 11px;
      text-transform: capitalize;
      color: #9ca3af;
    }
    .day-temp {
      font-weight: 600;
    }

    .icon-bubble {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      background: radial-gradient(circle at 30% 30%, #f9fafb, #cbd5f5);
      box-shadow: 0 0 14px rgba(148, 163, 184, 0.8);
    }

    .status-forecast {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
    }

    /* BOTTOM NAV */
    .bottom-nav {
      margin-top: 10px;
      display: flex;
      justify-content: space-around;
      font-size: 11px;
      color: #9ca3af;
      border-top: 1px solid rgba(30, 41, 59, 0.9);
      padding-top: 8px;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      opacity: 0.8;
    }
    .nav-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
    }
    .nav-item.active {
      color: #e5e7eb;
    }
    .nav-item.active .nav-dot {
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      border: none;
      box-shadow: 0 0 10px rgba(56, 189, 248, 0.8);
    }
  </style>
</head>
<body data-theme="clear">
  <!-- floating bubbles -->
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>

  <div class="app-shell">
    <!-- LEFT: current weather -->
    <div class="panel current" id="currentPanel">
      <div class="panel-header-top">
        <div>
          <div class="app-title" id="titleCity">Weather</div>
          <div class="app-subtitle" id="titleDate">Search a city to begin</div>
        </div>
        <div class="badge">Live</div>
      </div>

      <div class="chip-row">
        <div class="chip active">Now</div>
        <div class="chip">Forecast</div>
        <div class="chip">Location</div>
      </div>

      <div class="search-row">
        <input id="cityInput" type="text" placeholder="Enter city (e.g., Nagpur)" />
        <button class="btn btn-primary" id="searchBtn">Search</button>
      </div>

      <button class="btn btn-secondary" id="locBtn">Use My Location</button>

      <div class="hero">
        <div class="hero-left">
          <div class="temp-main" id="tempMain">--¬∞C</div>
          <div class="cond-main" id="condMain">Waiting for data...</div>
          <div class="city-main" id="cityMain">No location selected</div>

          <div class="mini-grid">
            <div id="miniFeels">Feels like: --¬∞C</div>
            <div id="miniHum">Humidity: --%</div>
            <div id="miniWind">Wind: -- m/s</div>
            <div id="miniExtra">Condition: --</div>
          </div>
        </div>

        <div class="hero-scene">
          <div class="sun" id="sunIcon"></div>
          <div class="moon" id="moonIcon"></div>
          <div class="cloud-main" id="cloudMain"></div>
          <div class="cloud-small" id="cloudSmall"></div>
          <div class="rain-lines" id="rainLines"></div>
          <div class="fog-strip" id="fogStrip"></div>
          <div class="bolt" id="boltIcon"></div>
        </div>
      </div>

      <div class="status-line" id="statusLine">
        Ready. <span>Type a city or use your location.</span>
      </div>

      <div class="bottom-nav">
        <div class="nav-item active">
          <div class="nav-dot"></div>
          <div>Today</div>
        </div>
        <div class="nav-item">
          <div class="nav-dot"></div>
          <div>Forecast</div>
        </div>
        <div class="nav-item">
          <div class="nav-dot"></div>
          <div>Locations</div>
        </div>
      </div>
    </div>

    <!-- RIGHT: hourly + 5-day forecast -->
    <div class="panel forecast" id="forecastPanel">
      <div class="forecast-header">
        <div>
          <div class="forecast-title">Forecast overview</div>
          <div class="forecast-sub" id="forecastSub">No data loaded</div>
        </div>
        <div class="badge">5-day ¬∑ 3-hour</div>
      </div>

      <div class="forecast-sub" style="margin-bottom:4px;">Hourly forecast</div>
      <div class="hourly-strip" id="hourlyStrip">
        <div class="forecast-sub">No hourly data.</div>
      </div>

      <div class="forecast-sub" style="margin:4px 0;">Next 5 days</div>
      <div class="forecast-list" id="forecastList">
        <div class="status-forecast">Forecast will appear after you search.</div>
      </div>

      <div class="status-forecast">
        Powered by <span style="color:#a5b4fc;">OpenWeatherMap</span> ¬∑ BCA Project
      </div>
    </div>
  </div>

  <script>
    const API_KEY = "4a34dacf20f9cf42c390ebc5138f2e94";

    const cityInput = document.getElementById("cityInput");
    const searchBtn = document.getElementById("searchBtn");
    const locBtn    = document.getElementById("locBtn");

    const titleCity = document.getElementById("titleCity");
    const titleDate = document.getElementById("titleDate");

    const tempMain  = document.getElementById("tempMain");
    const condMain  = document.getElementById("condMain");
    const cityMain  = document.getElementById("cityMain");
    const miniFeels = document.getElementById("miniFeels");
    const miniHum   = document.getElementById("miniHum");
    const miniWind  = document.getElementById("miniWind");
    const miniExtra = document.getElementById("miniExtra");
    const statusLine= document.getElementById("statusLine");

    const sunIcon   = document.getElementById("sunIcon");
    const moonIcon  = document.getElementById("moonIcon");
    const cloudMainEl = document.getElementById("cloudMain");
    const cloudSmallEl= document.getElementById("cloudSmall");
    const rainLines = document.getElementById("rainLines");
    const fogStrip  = document.getElementById("fogStrip");
    const boltIcon  = document.getElementById("boltIcon");

    const hourlyStrip   = document.getElementById("hourlyStrip");
    const forecastList  = document.getElementById("forecastList");
    const forecastSub   = document.getElementById("forecastSub");

    function setStatus(msg, extra = "") {
      if (extra) {
        statusLine.innerHTML = `${msg} <span>${extra}</span>`;
      } else {
        statusLine.textContent = msg;
      }
    }

    function resetIcons() {
      sunIcon.style.opacity = 0;
      moonIcon.style.opacity = 0;
      cloudMainEl.style.opacity = 0;
      cloudSmallEl.style.opacity = 0;
      rainLines.style.opacity = 0;
      fogStrip.style.opacity = 0;
      boltIcon.style.opacity = 0;
      if (boltIcon._timer) {
        clearInterval(boltIcon._timer);
        boltIcon._timer = null;
      }
    }

    function flashBolt() {
      boltIcon.style.opacity = 1;
      setTimeout(() => { boltIcon.style.opacity = 0; }, 140);
    }

    function applyScene(main, isNight) {
      const m = main.toLowerCase();
      resetIcons();

      if (m.includes("clear")) {
        document.body.dataset.theme = "clear";
        if (isNight) {
          moonIcon.style.opacity = 1;
        } else {
          sunIcon.style.opacity = 1;
        }
      } else if (m.includes("cloud")) {
        document.body.dataset.theme = "clouds";
        cloudMainEl.style.opacity = 1;
        cloudSmallEl.style.opacity = 1;
        if (isNight) {
          moonIcon.style.opacity = 1;
        } else {
          sunIcon.style.opacity = 1;
        }
      } else if (m.includes("rain") || m.includes("drizzle")) {
        document.body.dataset.theme = "rain";
        cloudMainEl.style.opacity = 1;
        cloudSmallEl.style.opacity = 1;
        rainLines.style.opacity = 1;
        if (Math.random() > 0.6) flashBolt();
      } else if (m.includes("thunder")) {
        document.body.dataset.theme = "storm";
        cloudMainEl.style.opacity = 1;
        cloudSmallEl.style.opacity = 1;
        rainLines.style.opacity = 1;
        boltIcon._timer = setInterval(flashBolt, 1500);
      } else if (
        m.includes("fog") ||
        m.includes("mist") ||
        m.includes("haze") ||
        m.includes("smoke")
      ) {
        document.body.dataset.theme = "fog";
        fogStrip.style.opacity = 1;
        cloudMainEl.style.opacity = 0.6;
      } else {
        document.body.dataset.theme = "clear";
        if (isNight) {
          moonIcon.style.opacity = 1;
        } else {
          sunIcon.style.opacity = 1;
        }
      }
    }

    function renderCurrent(data) {
      const temp  = Math.round(data.main.temp);
      const feels = Math.round(data.main.feels_like);
      const desc  = data.weather[0].description;
      const main  = data.weather[0].main;
      const hum   = data.main.humidity;
      const wind  = data.wind.speed;
      const name  = data.name;

      const nowUnix = data.dt;
      const sunrise = data.sys.sunrise;
      const sunset  = data.sys.sunset;
      const isNight = nowUnix < sunrise || nowUnix > sunset;

      const dt = new Date(nowUnix * 1000);
      const dateStr = dt.toLocaleDateString(undefined, { weekday: "long", day: "numeric", month: "short" });

      titleCity.textContent = name || "Weather";
      titleDate.textContent = dateStr;

      tempMain.textContent = temp + "¬∞C";
      condMain.textContent = desc;
      cityMain.textContent = name;

      miniFeels.textContent = "Feels like: " + feels + "¬∞C";
      miniHum.textContent   = "Humidity: " + hum + "%";
      miniWind.textContent  = "Wind: " + wind + " m/s";
      miniExtra.textContent = "Condition: " + main;

      setStatus("Last updated:", new Date().toLocaleTimeString());
      applyScene(main, isNight);
    }

    function iconFor(main) {
      const m = main.toLowerCase();
      if (m.includes("sun") || m.includes("clear")) return "‚òÄÔ∏è";
      if (m.includes("cloud")) return "‚òÅÔ∏è";
      if (m.includes("rain") || m.includes("drizzle")) return "üåßÔ∏è";
      if (m.includes("thunder")) return "‚õàÔ∏è";
      if (m.includes("snow")) return "‚ùÑÔ∏è";
      if (m.includes("fog") || m.includes("mist") || m.includes("haze")) return "üå´Ô∏è";
      return "üå°Ô∏è";
    }

    function renderForecast(data) {
      const list = data.list;
      if (!list || !list.length) {
        forecastSub.textContent = "No forecast data.";
        forecastList.innerHTML = '<div class="status-forecast">No forecast available.</div>';
        hourlyStrip.innerHTML = '<div class="forecast-sub">No hourly data.</div>';
        return;
      }

      // Hourly (next 8 slots)
      hourlyStrip.innerHTML = "";
      list.slice(0, 8).forEach((item, idx) => {
        const d = new Date(item.dt * 1000);
        const timeStr = d.toLocaleTimeString(undefined, { hour: "2-digit", minute: "2-digit" });
        const t = Math.round(item.main.temp);
        const desc = item.weather[0].main;
        const card = document.createElement("div");
        card.className = "hour-card";
        card.style.animationDelay = 0.05 * idx + "s";
        card.innerHTML = `
          <div class="hour-time">${timeStr}</div>
          <div class="hour-temp">${t}¬∞C</div>
          <div class="hour-cond">${desc}</div>
        `;
        hourlyStrip.appendChild(card);
      });

      // Daily grouping
      const daily = {};
      list.forEach((item) => {
        const dateStr = item.dt_txt.split(" ")[0];
        if (!daily[dateStr]) {
          daily[dateStr] = {
            min: item.main.temp_min,
            max: item.main.temp_max,
            main: item.weather[0].main,
            desc: item.weather[0].description,
          };
        } else {
          daily[dateStr].min = Math.min(daily[dateStr].min, item.main.temp_min);
          daily[dateStr].max = Math.max(daily[dateStr].max, item.main.temp_max);
        }
      });

      const entries = Object.entries(daily).slice(0, 5);
      forecastList.innerHTML = "";
      if (!entries.length) {
        forecastList.innerHTML = '<div class="status-forecast">No forecast data.</div>';
        return;
      }

      const startLabel = new Date(entries[0][0]).toLocaleDateString(undefined, {
        weekday: "long",
        day: "numeric",
        month: "short",
      });
      forecastSub.textContent = "From " + startLabel;

      entries.forEach(([dateStr, info], idx) => {
        const d = new Date(dateStr);
        const label = idx === 0
          ? "Today"
          : d.toLocaleDateString(undefined, { weekday: "short", day: "numeric" });
        const emoji = iconFor(info.main);
        const card = document.createElement("div");
        card.className = "forecast-card";
        card.style.animationDelay = 0.05 * idx + "s";
        card.innerHTML = `
          <div class="day-label">
            <div class="day-main">${label}</div>
            <div class="day-cond">${info.desc}</div>
          </div>
          <div class="day-temp">${Math.round(info.min)}¬∞ / ${Math.round(info.max)}¬∞</div>
          <div class="icon-bubble">${emoji}</div>
        `;
        forecastList.appendChild(card);
      });
    }

    async function fetchCurrentByCity(city) {
      setStatus("Loading weather for", city + "...");
      const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("City not found");
      return res.json();
    }

    async function fetchForecastByCity(city) {
      const url = `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Forecast not available");
      return res.json();
    }

    async function fetchCurrentByCoords(lat, lon) {
      setStatus("Loading your location weather...");
      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Location error");
      return res.json();
    }

    async function fetchForecastByCoords(lat, lon) {
      const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Location forecast error");
      return res.json();
    }

    async function handleSearch() {
      const city = cityInput.value.trim();
      if (!city) {
        alert("Please enter a city name.");
        return;
      }
      try {
        const [current, forecast] = await Promise.all([
          fetchCurrentByCity(city),
          fetchForecastByCity(city),
        ]);
        renderCurrent(current);
        renderForecast(forecast);
      } catch (err) {
        console.error(err);
        setStatus("Error:", err.message);
        condMain.textContent = "Unable to load weather.";
      }
    }

    function handleLocation() {
      if (!navigator.geolocation) {
        alert("Geolocation not supported.");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        async (pos) => {
          const { latitude, longitude } = pos.coords;
          try {
            const [current, forecast] = await Promise.all([
              fetchCurrentByCoords(latitude, longitude),
              fetchForecastByCoords(latitude, longitude),
            ]);
            renderCurrent(current);
            renderForecast(forecast);
          } catch (err) {
            console.error(err);
            setStatus("Error:", err.message);
          }
        },
        (err) => {
          console.error(err);
          alert("Unable to access location. Please allow permission.");
        }
      );
    }

    searchBtn.addEventListener("click", handleSearch);
    cityInput.addEventListener("keyup", (e) => {
      if (e.key === "Enter") handleSearch();
    });
    locBtn.addEventListener("click", handleLocation);
  </script>
</body>
</html>